# Enrich Brands Command

Automatically find and save websites for new brands from the weekly sync.

## When to Run

After any scrape that adds NEW_COMPANY or NEW_BRAND records. Typically:
- Friday morning before 2pm ET (after Thursday 10pm weekly sync)
- Any time user requests enrichment

## Priority Order (CRITICAL)

**Phase 1: High-value signals (all dates first)**
1. 01/08: NEW_COMPANY, then NEW_BRAND, then NEW_SKU
2. 01/07: NEW_COMPANY, then NEW_BRAND, then NEW_SKU
3. 01/06: NEW_COMPANY, then NEW_BRAND, then NEW_SKU
4. (continue backwards through all dates in scrape)

**Phase 2: REFILE signals (after all high-value done)**
5. 01/08: REFILE
6. 01/07: REFILE
7. (continue backwards)

The `needs_enrichment.json` file is already sorted this way.

## What Gets Enriched

All signal types in priority order:
- **NEW_COMPANY**: ~5-15 per week (highest priority)
- **NEW_BRAND**: ~150-200 per week
- **NEW_SKU**: Inherits brand website if already enriched, otherwise needs enrichment
- **REFILE**: Lowest priority, only if time permits

## Workflow

1. **Read the enrichment list**
   ```
   Read logs/needs_enrichment.json
   ```
   This was generated by the weekly sync. Shows brands sorted by:
   - Most recent approval_date first
   - NEW_COMPANY before NEW_BRAND within each date

2. **For each brand (in order!) - ALWAYS USE ALL THREE:**
   - Search format: `"[Brand Name]" [Category] "[Company Name]"`
   - Example: `"Stella Di Campalto" Wine "Oenoteca" OR "A&N Fine Wines"`

   **CRITICAL:** Same brand names exist from DIFFERENT companies!
   - Example: "FIELD & STREAM" = Drowned Lands Brewery (beer) AND Sugarlands (moonshine)
   - You MUST verify the website matches the SPECIFIC company in the filing

   - Skip retailers (drizly, totalwine, amazon, wine-searcher, vivino)
   - Pick the official producer website that matches the filing company

3. **Save to D1:**
   ```bash
   cd worker && npx wrangler d1 execute bevalc-colas --remote --command="INSERT OR REPLACE INTO brand_websites (brand_name, website_url, confidence, verified_at) VALUES ('BRAND', 'https://...', 'High', datetime('now'))"
   ```

4. **Report progress:**
   ```
   [1/184] BRAND NAME -> website.com (NEW_COMPANY)
   [2/184] ANOTHER BRAND -> anothersite.com (NEW_BRAND)
   [3/184] OBSCURE BRAND -> N/A (not found)
   ```

5. **Save progress regularly** to `logs/enrichment_progress.json` in case of interruption.

## Multi-Company Brands

If the same brand is filed by multiple companies:
1. Note this in output
2. Use `company_websites` table instead of `brand_websites`
3. Each company gets their own website entry

## Completion

After enrichment:
- Brands with websites show clickable link in modal
- Brands without show "Data enrichment in progress"
- Friday 2pm email sends automatically with available data

## Quick Start

Just say: "Run /enrich-brands" or "enrich the new brands"

Claude will:
1. Read the enrichment list
2. Search for each brand's website
3. Save to D1 in batches
4. Report progress as it goes
